server.port=9090
logging.level.org.springframework.cloud.gateway=INFO
logging.level.org.springdoc=INFO

# ============================================
# CONFIGURACIÓN DE MICROSERVICIOS Y SEGURIDAD
# ============================================

# URL del microservicio de usuarios (para el enrutamiento)
api-gw.url-microservicio-usuarios=http://users-service:9091

# JWK Set URI de Keycloak para validación de tokens
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=http://keycloak:8080/realms/tesina/protocol/openid-connect/certs

# ============================================
# ENRUTAMIENTO (SPRING CLOUD GATEWAY)
# ============================================

# Ruta principal para el API de usuarios
spring.cloud.gateway.routes[0].id=usuarios-service
spring.cloud.gateway.routes[0].uri=${api-gw.url-microservicio-usuarios}
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/usuarios/**, /api/auth/**

# Ruta para la documentación OpenAPI del servicio de usuarios
spring.cloud.gateway.routes[1].id=usuarios-docs
spring.cloud.gateway.routes[1].uri=${api-gw.url-microservicio-usuarios}
spring.cloud.gateway.routes[1].predicates[0]=Path=/v3/api-docs/usuarios
spring.cloud.gateway.routes[1].filters[0]=RewritePath=/v3/api-docs/usuarios, /v3/api-docs

# ============================================
# CONFIGURACIÓN DE SWAGGER UI
# ============================================

# Habilitar y configurar la ruta de la UI de Swagger
# No deshabilitamos api-docs en el gateway, para permitir que la infraestructura de springdoc
# que sirve la UI se inicialice correctamente. El gateway generará una documentación vacía,
# pero la UI estará configurada para apuntar al servicio de usuarios.
springdoc.swagger-ui.enabled=true

# Configurar la URL que la UI de Swagger usará para encontrar la definición de la API
springdoc.swagger-ui.urls[0].name=Users Service
springdoc.swagger-ui.urls[0].url=/v3/api-docs/usuarios

# ============================================
# OTROS
# ============================================

# Actuator
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.health.defaults.enabled=true

# Rate limiting (se mantiene la configuración anterior)
app.rate-limit.default-capacity=20
app.rate-limit.default-refill-tokens=10
app.rate-limit.routes[/api/usuarios/create].capacity=10
app.rate-limit.routes[/api/usuarios/create].refill-tokens=5
app.rate-limit.routes[/api/usuarios/list/**].capacity=40
app.rate-limit.routes[/api/usuarios/list/**].refill-tokens=20